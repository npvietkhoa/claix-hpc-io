#!/usr/bin/zsh
#SBATCH --beeond
#SBATCH --exclusive

#SBATCH --job-name=Recorder-{{ binary.replace('.x', '.' ~ ntasks) }}
#SBATCH --time=01:59:00
#SBATCH --output=/hpcwork/ph077533/recorder-logs/{{ binary.replace('.x', '.' ~ ntasks) }}.out

#SBATCH --ntasks={{ ntasks }}
#SBATCH --nodes=1

# Load required libs
ml purge
ml load iimpi
ml load HDF5

export RECORDER_POSIX_TRACING=1
export RECORDER_MPIIO_TRACING=1
export RECORDER_MPI_TRACING=1
export RECORDER_HDF5_TRACING=1
export RECORDER_TRACES_DIR=$HPCWORK/recorder-results/{{ binary.replace('.x', '.' ~ ntasks) }}

cp -r $HPCWORK/NPB3.4.3/NPB3.4-MPI/bin/{{ binary }} $BEEOND
LD_PRELOAD=$HPCWORK/Recorder/install/lib/librecorder.so $MPIEXEC $BEEOND/{{ binary.replace('.x', '.' ~ ntasks) }}

